<div class="container" [class.file-uploaded]="selectedContractId !== null">
  <div class="row">
    <div *ngIf="selectedContractId === null" class="col upload-col">
      <h2>Upload New Contract</h2>
      <input type="file" (change)="onFileSelected($event)" accept=".pdf">
      <button (click)="uploadFile()" class="upload-button">Upload PDF</button>
      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
        <button (click)="clearErrorMessage()">Dismiss</button>
      </div>
      <div *ngIf="isLoadingContracts">Loading contracts...</div>
      <div *ngIf="!isLoadingContracts && contracts.length > 0">
        <h3>Existing Contracts</h3>
        <ul>
          <li *ngFor="let contract of contracts">
            <a (click)="fetchContractById(contract.id)">{{ contract.originalFileName }}</a>
          </li>
        </ul>
      </div>
      <div *ngIf="!isLoadingContracts && contracts.length === 0">No contracts found.</div>
    </div>
    <div *ngIf="selectedContractId !== null" class="col contract-col">
      <h3>Contract:</h3>
      <textarea [readonly]="!isEditing" [(ngModel)]="uploadResponse"></textarea>
      <button *ngIf="!isEditing" (click)="startEditing()">Edit</button>
      <div *ngIf="isEditing" class="button-group">
        <button (click)="saveEdits()" [disabled]="loading">Save</button>
        <button (click)="cancelEditing()" [disabled]="loading">Cancel</button>
      </div>
      <div *ngIf="loading">Updating PDF...</div>
      <div class="contract-details">
        <a [href]="blobStorageLocation" target="_blank">Download Updated File</a>
      </div>
    </div>
    <div *ngIf="selectedContractId !== null" class="col dialog-col">
      <h3>Contract Details:</h3>
      <p><strong>Contract Type:</strong> {{contractType}}</p>
      <p><strong>Product:</strong> {{product}}</p>
      <p><strong>Price:</strong> {{price}}</p>
      <p><strong>Volume:</strong> {{volume}}</p>
      <p><strong>Delivery Terms:</strong> {{deliveryTerms}}</p>
      <p *ngIf="contractType === 'Forward Contract'"><strong>Future Delivery Date:</strong> {{futureDeliveryDate | date:'medium'}}</p>
      <p *ngIf="contractType === 'Forward Contract'"><strong>Settlement Terms:</strong> {{settlementTerms}}</p>
      <p><strong>Appendix:</strong> {{appendix}}</p>
      <hr/>
      <h3>Dialog:</h3>
      <textarea [(ngModel)]="prompt" placeholder="Prompt LLM"></textarea>
      <button (click)="sendPrompt()">Send Prompt</button>
      <div *ngIf="loading">Loading...</div>
      <div *ngIf="response" class="response-content">
        <pre [innerHTML]="response"></pre>
      </div>
    </div>
  </div>
</div>